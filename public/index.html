<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Divina Player</title>
	<style type="text/css">
		body, html {
			margin: 0;
			padding: 0;
			overflow: hidden;
			background-color: #444444;
		}
		#stage {
			position: fixed;
			left: 0;
			right: 0;
			top: 0;
			bottom: 0;
		}
		.fullscreen {
			position: fixed;
			left: 0;
			right: 0;
			top: 0;
			bottom: 0;
			pointer-events: none;
			display: flex;
			flex-direction: column;
			align-items: center;
		}
	</style>
	<script src="../dist/divina.iife.js"></script>
</head>
<body>
	<script type="text/javascript">


		// Configurable input


		// List of story folder URLs (relative to index.html's parent folder)
		let storyFoldersArray = ["tests/webtoon1", "tests/webtoon2", "tests/turbomedia1", "tests/turbomedia2"];
		
		// Length of time during which the menu is open (i.e. before it closes automatically)
		// after the first resources of a Divina have been fully downloaded by the player
		// (value should be null or <= 0 to prevent the menu from opening automatically)
		let durationOfOpeningAtStart = 1500;
		
		// URL of the specific page/resource to access directly (i.e. start reading from) in a divina
		let targetUrl = "http://google.fr/";

		// Options for the Divina Player
		let options = {
			maxNbOfUnitsToLoadAfter: null,
			initialNbOfResourcesToLoad: null,
			allowsDestroy: false,
			allowsParallel: true,
			//allowsZoom: true,
			allowsSwipe: true,
			allowsWheelScroll: true,
			allowsPaginatedScroll: true,
			isPaginationSticky: true,
			isPaginationGridBased: true,
			videoLoadTimeout: 2000,
		};



		// Function for dispatching events
		let signal = function (eventName, eventData = null) {
			const event = document.createEvent("Event");
			event.initEvent(eventName, true, true);
			if (eventData) {
				event.customData = eventData;
			}
			document.dispatchEvent(event);
		};

		// Function for loading a CSS stylesheet in the additional JS scrips
		let loadCSS = function (url) {
			let head = document.getElementsByTagName("HEAD")[0];
			let link = document.createElement("link");
			link.rel = "stylesheet";
			link.type = "text/css";
			link.href = url;
			head.appendChild(link);
		};

		// Function for creating a div, adding it to a parent DOM element and setting a few props
		let createAndAddDivElement = function (parentElement, props) {
			let element = document.createElement("div");
			if (props) {
				Object.entries(props).forEach(function ([key, value]) {
					if (key === "id" || key === "class") {
						element.setAttribute(key, value);
					} else if (key === "style") {
						Object.entries(value).forEach(function ([subkey, subvalue]) {
							element.style[subkey] = subvalue;
						});
					} else {
						element[key] = value;
					}
				});
			}
			if (parentElement) {
				parentElement.appendChild(element);
			}
			return element;
		};

		window.onload = function () {

			// Create the rootElement for the Divina Player programmatically 
			let stage = createAndAddDivElement(window.document.body, { id: "stage" });

			let Player = divinaPlayer;
			if (!Player) {
				console.error("ERROR TO LOAD THE LOAD PLAYER")
				return
			}

			// Create the player
			let player = new Player(stage, "transparent");
			console.log(player)
			// Load the divina from its folder path
			player.openDivinaFromFolderPath(storyFoldersArray[0], targetUrl, options)

			// Handle events emitted by the player
			let eventEmitter = player.eventEmitter
			eventEmitter.on("jsonload", (data) => {
				console.log("JSON load", data)
			})
			eventEmitter.on("pagenavigatorscreation", (data) => {
				console.log("Page navigators creation", data)
			})
			eventEmitter.on("initialload", (data) => {
				console.log("Initial load", data)
			})
			eventEmitter.on("languagechange", (data) => {
				console.log("Language change", data)
			})
			eventEmitter.on("readingmodechange", (data) => {
				console.log("Reading mode change", data)
			})
			eventEmitter.on("readingmodeupdate", (data) => {
				console.log("Reading mode update", data)
			})
			eventEmitter.on("pagechange", (data) => {
				console.log("Page change", data)
			})
			/*eventEmitter.on("inpagescroll", (data) => {
				console.log("In-page scroll", data)
			})*/
		}

	</script>
</body>
</html> 